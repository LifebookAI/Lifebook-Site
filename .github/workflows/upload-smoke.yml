name: Upload smoke

on:
  workflow_dispatch:

jobs:
  presign_and_upload:
    runs-on: windows-latest

    # Map GitHub Secrets -> environment variables the script expects
    env:
      API_BASE: ${{ secrets.PRESIGN_API_BASE }}
      API_KEY:  ${{ secrets.PRESIGN_API_KEY }}
      SECRET:   ${{ secrets.PRESIGN_HMAC_SECRET }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Sanity-check inputs (masked)
        shell: pwsh
        run: |
          Write-Host "API_BASE length: $(${env:API_BASE}.Length)"
          Write-Host "API_KEY  length: $(${env:API_KEY}.Length)"
          Write-Host "SECRET  length: $(${env:SECRET}.Length)"

      - name: Presign + upload
        shell: pwsh
        run: .github/workflows/scripts/presign-smoke.ps1

      - name: Show generated URL (if any)
        if: always()
        shell: pwsh
        run: |
          Write-Host "Done."
