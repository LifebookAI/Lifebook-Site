name: Upload smoke

on:
  workflow_dispatch: {}   # enables the "Run workflow" button

jobs:
  presign_and_upload:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Presign + Upload (PowerShell script)
        shell: pwsh
        env:
          PRESIGN_API_BASE:      ${{ secrets.PRESIGN_API_BASE }}
          PRESIGN_API_KEY:       ${{ secrets.PRESIGN_API_KEY }}
          PRESIGN_HMAC_SECRET:   ${{ secrets.PRESIGN_HMAC_SECRET }}

          # repo variables (or make them secrets too if you prefer)
          LIFEBOOK_UPLOAD_PREFIX:  ${{ vars.LIFEBOOK_UPLOAD_PREFIX }}
          CLOUDFRONT_DOMAIN:       ${{ vars.CLOUDFRONT_DOMAIN }}
          PRESIGN_TS_STYLE:        ${{ vars.PRESIGN_TS_STYLE }}
          PRESIGN_SIG_PATTERN:     ${{ vars.PRESIGN_SIG_PATTERN }}
          PRESIGN_SIG_ENCODING:    ${{ vars.PRESIGN_SIG_ENCODING }}
        run: |
          # Run our script that does presign + PUT + verify
          ./.github/workflows/scripts/presign-smoke.ps1
